<!-- @format -->

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Headpat Overlay</title>

		<!-- ========== COMFYJS LIBRARY ========== -->
		<!-- This is the bridge between Twitch chat and your code -->
		<!-- It listens for commands, redeems, follows, etc. -->
		<script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>

		<style>
			/* ========== BASE STYLES ========== */
			/* Makes the background invisible in OBS */
			body {
				margin: 0;
				background: transparent;
				overflow: hidden;
				width: 100vw;
				height: 100vh;
			}

			/* ========== HAND IMAGE ========== */
			.hand {
				position: absolute;
				top: -200px; /* Starts off-screen above */
				left: 50%; /* Centered horizontally */
				transform: translateX(-50%); /* Truly centers it */
				width: 200px; /* Adjust size as needed */
				height: auto;
				opacity: 0; /* Invisible until triggered */
			}

			/* ========== ANIMATION TRIGGER ========== */
			/* When .patting class is added, hand becomes visible and animates */
			.hand.patting {
				opacity: 1;
				animation: pet-pet 0.4s ease-in-out 5; /* 5 pats! */
			}

			/* ========== THE PETTING MOTION ========== */
			/* Keyframes define the movement over time */
			@keyframes pet-pet {
				/* Start position: hand is up and tilted back */
				0% {
					top: -50px;
					transform: translateX(-50%) rotate(-10deg);
				}
				/* Middle position: hand pushes down onto head */
				50% {
					top: 30px; /* Adjust this to hit your head right! */
					transform: translateX(-50%) rotate(5deg);
				}
				/* End position: hand lifts back up */
				100% {
					top: -50px;
					transform: translateX(-50%) rotate(-10deg);
				}
			}
		</style>
	</head>
	<body>
		<!-- ========== THE HAND IMAGE ========== -->
		<!-- Make sure the image file is in the same folder as this HTML -->
		<img src="./hand.png" alt="Pat hand" class="hand" id="hand" />

		<script>
			// ========== CONFIG ==========
			// Your Twitch channel name (lowercase)
			const YOUR_CHANNEL = "mavscriptblu";

			// ========== GRAB THE HAND ELEMENT ==========
			const hand = document.getElementById("hand");

			// ========== THE ANIMATION FUNCTION ==========
			// This gets called whenever someone triggers a headpat
			function triggerHeadpat(username) {
				console.log(`${username} is petting you!`);

				// Add the .patting class to start the animation
				hand.classList.add("patting");

				// Remove the class after animation finishes
				// This resets it so it can be triggered again
				// Math: 5 pats Ã— 0.4s = 2 seconds + 100ms buffer
				setTimeout(() => {
					hand.classList.remove("patting");
				}, 2100);
			}

			// ========== CHAT COMMAND LISTENER ==========
			// Fires whenever someone uses a ! command in chat
			ComfyJS.onCommand = (user, command, message, flags, extra) => {
				// Check if the command matches any of our trigger words
				// !headpat, !pat, or !pet will all work
				if (command === "headpat" || command === "pat" || command === "pet") {
					triggerHeadpat(user);
				}
			};

			// ========== CONNECT TO TWITCH ==========
			// This starts listening to your channel's chat
			ComfyJS.Init(YOUR_CHANNEL);

			// ========== TEST MODE ==========
			// Click anywhere on the page to test the animation
			// DELETE THIS after you've confirmed it works!
			document.body.addEventListener("click", () => triggerHeadpat("TestUser"));
		</script>
	</body>
</html>
